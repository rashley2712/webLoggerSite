<html>
	<head>
		<meta charset="UTF-8">
	 	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<style>

		 <!-- <link rel="stylesheet" href="bootstrap.css"> -->
		 <title>Live WebLogger</title>
		<style>
			.headerdata {
				font-size: 10pt;
				}
			#logTable tr:hover {
     		background-color: lightgrey;
			}
			
			
			table {
    			border-collapse: collapse;
			}

			table, th {
    			border: 1px solid black;
			}

			th, td {
    			padding: 5px;
    			text-align: center;
			}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-sanitize.js"></script>
		<script language="javascript" type="text/javascript" src="astro.js-master/astro.js"></script>
		<script language="javascript" type="text/javascript" src="astro.js-master/astro.constants.js"></script>
		<script language="javascript" type="text/javascript" src="astro.js-master/astro.dates.js"></script>
		<script language="javascript" type="text/javascript" src="astro.js-master/astro.ephem.js"></script>
		
		<script src="datahandler.js"></script>
		<!--<script src="jquery-3.2.1.min.js"></script> -->

		<script>
		window.addEventListener("load", pageLoaded, false);
		function pageLoaded() {
			console.log("Page has loaded.");
			timerID = setInterval(clockTicker, 1000);
		}
		
		function clockTicker() {
			var LMSiderealTime = astrojs.dates.getLST(new Date(), 342.1184);
			document.getElementById('LSTField').innerText = timeDecimalToHMS(LMSiderealTime);
		}
		
		function zeroPad(input) {
			if (input < 10) return "0" + input.toString();
			return input.toString();
		}
		
	    // As packages may require dependencies that load
	    // asynchronously, we should wait for them
	    astrojs.ready(function(e){
	        console.log("astro.js is ready.");
	        var jd = astrojs.dates.getJulianDate();
	        console.log("Julian date: ", jd);                  //  print the Julian Date to the console
	        console.log("Sun position: ", astrojs.ephem.sunPos(jd));
	        console.log("Moon position: ", astrojs.ephem.moonPos(jd));
			console.log("LST: ", timeDecimalToHMS(astrojs.dates.getLST(new Date(), 342.1184)));
	    });
		
		function timeDecimalToHMS(inputTime){
			hours = Math.floor(inputTime);
			inputTime-=hours;
			minutes = Math.floor(inputTime*60);
			inputTime = inputTime*60 - minutes;
			seconds = Math.floor(inputTime*60);
			timeString = zeroPad(hours) + ":" + zeroPad(minutes) + ":" + zeroPad(seconds);
			return timeString;
		}
		

		</script>

</head>

<body ng-app="LogApp"  ng-controller="dbController" ng-init="init()">
	<div>
		<img ng-src="{{ telescope.imageURL }}" width="10%" align="right"/>
		<h1 id="pageheading">{{ telescope.name }} log for {{instrument}} on date: {{ dateString }}</h1>
		<select ng-model="telescope" ng-options="t.name for t in telescopes" ng-change="load()">
		</select>
		<input id="datePicker" ng-model="date" type="date" ng-change="dateChange()"/>
		<button class="btn" ng-click="clear()">Clear</button>
		<button class="btn" ng-click="startRefresh()">Start refresh</button>
		<table align="right">
			<tr>
				<th>Sidereal time</th>				
				<th>Total exposure time (s)</th>
				<th>Total time on targets (s)</th>
			</tr>
			<tr>
				<td><span id="LSTField">--:--</span></td>
				<td>{{ totalExposureTime | round }}</td>
				<td>{{ totalTargetTime | round }}</td>
			</tr>	
		</table>
	</div>


	<br/>
	
	<div>
		{{ statusString }}
		<span>Sorting by: {{sortColumn}}  Reverse: {{ sortReverse }}</span>
		
		<table id="logTable" width="100%">
			<tr><th ng-repeat="c in instrumentColumns" ng-click="changeSort(c.sort);"><span ng-bind-html="c.name">{{ c.name }}</span></th></tr>
			<tr ng-repeat="row in db">
				<td ng-repeat="c in instrumentColumns">{{ row[c.id] | picker:c.format }}</td>
			</tr> 
		</table>
	</div>
	<br/>

</body>


</html>
